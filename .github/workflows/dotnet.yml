name: .NET

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build_and_deploy:

    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v2
    
    - name: setup-msbuild
      uses: microsoft/setup-msbuild@v1.1
      
    - name: Setup NuGet.exe for use with actions
      uses: NuGet/setup-nuget@v1.0.5     
      
    - name: Setup VSTest
      uses: darenm/Setup-VSTest@v1
        
    - name: Restore NuGet Packages
      run: nuget restore GitHubActionDemo.sln

    - name: Build app
      run: msbuild GitHubActionDemo.sln
      
    - name: Run UnitTests
      run: vstest.console.exe GitHubActionDemoUnitTests/bin/Debug/GitHubActionDemoUnitTests.dll

    - name: Build app for release
      run: msbuild GitHubActionDemo.sln /t:GitHubActionDemo /p:DeployOnBuild=true /p:WebPublishMethod=Package /p:PackageAsSingleFile=true /p:SkipInvalidConfigurations=true /p:configuration="release" /p:PackageLocation=myapp
      
    - name: Upload Artifact
      uses: actions/upload-artifact@v1.0.0
      with:
        name: published_webapp
        path: GitHubActionDemo\myapp
